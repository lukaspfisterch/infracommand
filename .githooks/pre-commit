#!/bin/sh
# Pre-commit hook for InfraCommand
# Ensures code quality and version consistency

echo "üîç Running pre-commit checks..."

# Check if we're in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo "‚ùå Not in a git repository"
    exit 1
fi

# Check Python syntax
echo "üêç Checking Python syntax..."
python -m py_compile infracommand.py window_utils.py
if [ $? -ne 0 ]; then
    echo "‚ùå Python syntax errors found"
    exit 1
fi

# Check if CHANGELOG.md was updated for version changes
if git diff --cached --name-only | grep -q "pyproject.toml"; then
    if ! git diff --cached pyproject.toml | grep -q "version"; then
        echo "‚ö†Ô∏è  Version changed in pyproject.toml but CHANGELOG.md not updated"
        echo "   Please update CHANGELOG.md with the new version changes"
    fi
fi

# Check for TODO/FIXME comments in committed files
echo "üîç Checking for TODO/FIXME comments..."
if git diff --cached --name-only | grep -E "\.(py|ps1)$" | xargs grep -n "TODO\|FIXME" 2>/dev/null; then
    echo "‚ö†Ô∏è  Found TODO/FIXME comments in committed files"
    echo "   Consider resolving them before committing"
fi

echo "‚úÖ Pre-commit checks passed"
exit 0
